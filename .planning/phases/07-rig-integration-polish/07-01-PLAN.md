---
phase: 07-rig-integration-polish
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - rig-cli/Cargo.toml
  - rig-cli/src/lib.rs
  - rig-cli/src/config.rs
  - rig-cli/src/errors.rs
  - Cargo.toml
autonomous: true

must_haves:
  truths:
    - "rig-cli crate exists as a workspace member and compiles with cargo check"
    - "Feature flags claude, codex, opencode exist and default to all-on"
    - "Public error types wrap internal ProviderError with actionable Display messages"
    - "ClientConfig holds CLI-specific settings (binary path, timeout, channel capacity)"
  artifacts:
    - path: "rig-cli/Cargo.toml"
      provides: "Crate manifest with feature flags and dependencies"
      contains: "[features]"
    - path: "rig-cli/src/lib.rs"
      provides: "Public API root with feature-gated modules"
      contains: "cfg(feature"
    - path: "rig-cli/src/config.rs"
      provides: "Shared ClientConfig type"
      contains: "struct ClientConfig"
    - path: "rig-cli/src/errors.rs"
      provides: "Public error enum wrapping internal errors"
      contains: "enum Error"
    - path: "Cargo.toml"
      provides: "Workspace manifest including rig-cli member"
      contains: "rig-cli"
  key_links:
    - from: "rig-cli/Cargo.toml"
      to: "rig-provider"
      via: "path dependency"
      pattern: "rig-provider.*path"
    - from: "rig-cli/src/errors.rs"
      to: "rig-provider/src/errors.rs"
      via: "#[from] conversion"
      pattern: "ProviderError"
---

<objective>
Create the rig-cli facade crate skeleton with feature flags, shared config, and error types.

Purpose: Establish the public API crate that will wrap existing rig-provider internals behind Rig-idiomatic types. This crate is the entry point for downstream users.
Output: Compilable rig-cli crate with Cargo.toml, lib.rs, config.rs, errors.rs added as workspace member.
</objective>

<execution_context>
@/home/pnod/.claude/get-shit-done/workflows/execute-plan.md
@/home/pnod/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/07-rig-integration-polish/07-CONTEXT.md
@.planning/phases/07-rig-integration-polish/07-RESEARCH.md
@Cargo.toml
@rig-provider/Cargo.toml
@rig-provider/src/errors.rs
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create rig-cli crate with Cargo.toml and feature flags</name>
  <files>rig-cli/Cargo.toml, Cargo.toml</files>
  <action>
1. Create `rig-cli/` directory and `rig-cli/src/` subdirectory.

2. Create `rig-cli/Cargo.toml`:
   - Package name: `rig-cli`, version 0.1.0, edition 2021
   - Description: "Turn CLI-based AI agents into idiomatic Rig 0.29 providers"
   - Keywords: ["rig", "cli", "provider", "llm", "structured-extraction"]
   - Three feature flags: `claude` (default), `codex` (default), `opencode` (default)
   - All three default-on: `default = ["claude", "codex", "opencode"]`
   - Dependencies:
     - `rig-provider = { path = "../rig-provider" }` (always, not feature-gated — the adapter selection happens at the rig-cli module level, not at rig-provider compilation)
     - `rig = { package = "rig-core", version = "0.29.0" }` (re-export Rig types)
     - `thiserror = "1.0"` (error types)
     - `tokio = { version = "1.0", features = ["full"] }` (async runtime for Client::new)
     - `serde = { version = "1.0", features = ["derive"] }` (config serialization)
     - `serde_json = "1.0"` (JSON handling)
     - `tracing = "0.1"` (logging)
   - Add `[lints] workspace = true` to inherit workspace lints

3. Update root `Cargo.toml` workspace members to include `"rig-cli"`.

NOTE: Do NOT feature-gate rig-provider itself. The adapters inside rig-provider already compile unconditionally. Feature flags in rig-cli control which *modules* (claude.rs, codex.rs, opencode.rs) are compiled, not which adapter crates are pulled in. This is the simplest correct approach — matches how Rig's own providers work (always compiled, user picks which to use).
  </action>
  <verify>
Run `cargo check -p rig-cli` — should succeed even though src/lib.rs is minimal.
Verify `Cargo.toml` workspace members list includes "rig-cli".
  </verify>
  <done>rig-cli crate exists in workspace, compiles with `cargo check -p rig-cli`, has three feature flags all defaulting on.</done>
</task>

<task type="auto">
  <name>Task 2: Create lib.rs, config.rs, and errors.rs</name>
  <files>rig-cli/src/lib.rs, rig-cli/src/config.rs, rig-cli/src/errors.rs</files>
  <action>
1. Create `rig-cli/src/lib.rs`:
   - Add `#![deny(missing_docs)]` and crate-level doc comment explaining what rig-cli is
   - Feature-gated module declarations:
     ```rust
     #[cfg(feature = "claude")]
     pub mod claude;
     #[cfg(feature = "codex")]
     pub mod codex;
     #[cfg(feature = "opencode")]
     pub mod opencode;
     ```
   - Always-available modules:
     ```rust
     pub mod config;
     pub mod errors;
     ```
   - Placeholder prelude module (empty for now, will be populated in Plan 04):
     ```rust
     pub mod prelude;
     ```
   - Create empty placeholder files for `claude.rs`, `codex.rs`, `opencode.rs`, `prelude.rs` so that compilation works with all features enabled. Each should have just a doc comment like `//! Claude Code provider (implementation pending).`

2. Create `rig-cli/src/config.rs`:
   - `ClientConfig` struct with these fields:
     - `binary_path: Option<std::path::PathBuf>` — Override CLI binary location (None = auto-discover)
     - `timeout: std::time::Duration` — Max execution time (default 300s)
     - `channel_capacity: usize` — Bounded channel size (default 100)
   - Implement `Default` for `ClientConfig` with the documented defaults
   - Add `ClientConfig::new()` as alias for Default

3. Create `rig-cli/src/errors.rs`:
   - Public error enum `Error` with these variants:
     - `#[error("Claude Code CLI not found. Install: npm i -g @anthropic-ai/claude-code")] ClaudeNotFound`
     - `#[error("Codex CLI not found. Install: npm i -g @openai/codex")] CodexNotFound`
     - `#[error("OpenCode CLI not found. Install: go install github.com/nicholasgasior/opencode@latest")] OpenCodeNotFound`
     - `#[error("CLI execution failed: {0}")] ExecutionFailed(String)` — wraps non-zero exit, timeout
     - `#[error("{0}")] Provider(#[from] rig_provider::errors::ProviderError)` — catch-all from internal provider
     - `#[error("Rig completion error: {0}")] Completion(#[from] rig::completion::CompletionError)` — pass through Rig errors
     - `#[error("Configuration error: {0}")] Config(String)` — invalid config
   - Use `thiserror` derive
   - Keep Display messages actionable (user-facing), Debug for developers (auto from thiserror)
  </action>
  <verify>
Run `cargo check -p rig-cli` — should compile cleanly.
Run `cargo doc -p rig-cli --no-deps` — should generate docs without warnings.
  </verify>
  <done>lib.rs has feature-gated modules, config.rs has ClientConfig with defaults, errors.rs has Error enum with actionable messages. All compiles.</done>
</task>

</tasks>

<verification>
- `cargo check -p rig-cli` passes with zero errors
- `cargo check -p rig-cli --no-default-features` passes (errors and config always available)
- `cargo check -p rig-cli --features claude` passes (individual feature works)
- Workspace `Cargo.toml` includes "rig-cli" in members
</verification>

<success_criteria>
- rig-cli crate is a workspace member that compiles
- Three feature flags (claude, codex, opencode) exist and default on
- ClientConfig provides CLI-specific settings with sensible defaults
- Error enum wraps ProviderError with actionable Display messages
- All feature flag combinations compile
</success_criteria>

<output>
After completion, create `.planning/phases/07-rig-integration-polish/07-01-SUMMARY.md`
</output>
