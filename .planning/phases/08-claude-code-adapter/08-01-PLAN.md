---
phase: 08-claude-code-adapter
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - opencode-adapter/src/discovery.rs
  - opencode-adapter/src/process.rs
  - opencode-adapter/src/lib.rs
  - mcp/src/extraction/orchestrator.rs
  - rig-provider/src/mcp_agent.rs
  - rig-cli/src/claude.rs
  - rig-cli/src/codex.rs
  - rig-cli/src/opencode.rs
  - rig-cli/src/errors.rs
  - rig-cli/src/response.rs
  - rig-cli/Cargo.toml
autonomous: true

must_haves:
  truths:
    - "cargo clippy --workspace -- -W clippy::pedantic produces zero warnings"
    - "All doc_markdown warnings fixed (backticks around technical terms)"
    - "All missing_const_for_fn warnings fixed (const added where applicable)"
    - "All cast_possible_truncation warnings fixed (safe conversion patterns)"
    - "No #[allow] suppressions except with inline justification"
  artifacts:
    - path: "opencode-adapter/src/discovery.rs"
      provides: "Fixed doc_markdown warnings (OpenCode -> `OpenCode`)"
    - path: "rig-cli/src/claude.rs"
      provides: "Fixed cast_possible_truncation, doc_markdown warnings"
    - path: "mcp/src/extraction/orchestrator.rs"
      provides: "Fixed cast_possible_truncation warnings with saturating_cast"
  key_links:
    - from: "All workspace crates"
      to: "clippy pedantic"
      via: "zero warnings on cargo clippy"
      pattern: "warning:.*pedantic"
---

<objective>
Fix all clippy pedantic warnings workspace-wide.

Purpose: Production code quality - clippy pedantic is the standard for Rust libraries. Fixing root causes (not suppressing) ensures maintainable, idiomatic code.

Output: Zero clippy pedantic warnings across entire workspace.
</objective>

<execution_context>
@/home/pnod/.claude/get-shit-done/workflows/execute-plan.md
@/home/pnod/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/08-claude-code-adapter/08-CONTEXT.md
@.planning/phases/08-claude-code-adapter/08-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix doc_markdown and missing_errors_doc warnings</name>
  <files>
    opencode-adapter/src/discovery.rs
    opencode-adapter/src/process.rs
    opencode-adapter/src/lib.rs
    rig-provider/src/mcp_agent.rs
    rig-cli/src/claude.rs
    rig-cli/src/opencode.rs
    rig-cli/src/errors.rs
  </files>
  <action>
Fix all 27 doc_markdown warnings by adding backticks around technical terms:
- `OpenCode` (not OpenCode) in doc comments
- `CompletionModel` (not CompletionModel)
- `SandboxMode::ReadOnly` (not SandboxMode::ReadOnly)

Fix all 4 missing_errors_doc warnings by adding `# Errors` sections to:
- opencode-adapter/src/process.rs: run_opencode()
- opencode-adapter/src/lib.rs: check_health(), run(), stream()

Use `cargo clippy --fix --allow-dirty` for mechanical fixes, then manually verify doc quality.
  </action>
  <verify>
Run: `cargo clippy --workspace -- -W clippy::pedantic 2>&1 | grep -c "doc_markdown\|missing_errors_doc"` returns 0
  </verify>
  <done>All doc_markdown and missing_errors_doc warnings eliminated</done>
</task>

<task type="auto">
  <name>Task 2: Fix const fn, cast truncation, and stylistic warnings</name>
  <files>
    rig-provider/src/mcp_agent.rs
    rig-cli/src/codex.rs
    rig-cli/src/opencode.rs
    rig-cli/src/response.rs
    rig-cli/src/claude.rs
    mcp/src/extraction/orchestrator.rs
  </files>
  <action>
Fix 9 missing_const_for_fn warnings by adding `const` to:
- rig-provider/src/mcp_agent.rs: sandbox_mode()
- rig-cli/src/codex.rs: cli(), config()
- rig-cli/src/opencode.rs: cli(), config()
- rig-cli/src/response.rs: from_run_result()

Fix 4 cast_possible_truncation warnings in:
- mcp/src/extraction/orchestrator.rs (3 occurrences): Use saturating conversion
  ```rust
  // Instead of: start.elapsed().as_millis() as u64
  // Use: u64::try_from(start.elapsed().as_millis()).unwrap_or(u64::MAX)
  ```
- rig-cli/src/claude.rs (1 occurrence): Same pattern

Fix 6 unnecessary_raw_string_hashes warnings by removing extra hashes from raw strings.

Fix stylistic warnings:
- if_let_else -> use match where clippy suggests
- map_or_instead_of_if_let_else -> use Option::map_or
- struct_field_names (model_name in Model) -> keep existing #[allow(dead_code)] with added justification comment
  </action>
  <verify>
Run: `cargo clippy --workspace -- -W clippy::pedantic 2>&1 | grep -E "const fn|truncation|hashes|if let|map_or" | wc -l` returns 0
  </verify>
  <done>All const fn, truncation, raw string, and stylistic warnings fixed</done>
</task>

<task type="auto">
  <name>Task 3: Fix remaining warnings and verify zero-warning build</name>
  <files>
    rig-cli/Cargo.toml
    mcp/src/extraction/orchestrator.rs
    rig-provider/src/mcp_agent.rs
  </files>
  <action>
Fix remaining warnings:
- cargo_common_metadata: Add `readme = "README.md"` to rig-cli/Cargo.toml [package] section
- too_many_lines (orchestrator.rs extract fn): Add `#[allow(clippy::too_many_lines)]` with justification comment:
  ```rust
  // Extraction retry loop is inherently complex with 5 stages (prompt, call, parse, validate, retry).
  // Splitting would fragment the state machine and reduce readability.
  #[allow(clippy::too_many_lines)]
  ```
- too_many_arguments: Add `#[allow(clippy::too_many_arguments)]` with justification if present

For any remaining warnings that require #[allow]:
1. Add inline comment explaining WHY the allow is necessary
2. Prefer fixing root cause over suppression
3. Document any external limitations (e.g., API constraints)

Run final verification:
```bash
cargo clippy --workspace -- -W clippy::pedantic 2>&1 | tee /tmp/clippy-output.txt
grep -c "^warning:" /tmp/clippy-output.txt || echo "0 warnings"
```
  </action>
  <verify>
Run: `cargo clippy --workspace -- -W clippy::pedantic 2>&1 | grep "^warning:" | grep -v "generated\|Compiling\|Finished" | wc -l` returns 0
  </verify>
  <done>Zero clippy pedantic warnings workspace-wide with justified #[allow] where truly necessary</done>
</task>

</tasks>

<verification>
Full workspace clippy pedantic check:
```bash
cargo clippy --workspace -- -W clippy::pedantic
```
Expected: No warnings in output (only "Finished" line)

Verify no blind suppressions:
```bash
grep -r "#\[allow(clippy::" --include="*.rs" | grep -v "// " | wc -l
```
Expected: 0 (all allows have inline justification comments)
</verification>

<success_criteria>
- [ ] `cargo clippy --workspace -- -W clippy::pedantic` produces zero warnings
- [ ] No `#[allow(clippy::...)]` without inline justification comment
- [ ] All technical terms in doc comments have backticks
- [ ] All Result-returning public functions have `# Errors` sections
- [ ] All eligible functions marked `const fn`
- [ ] No unsafe truncation casts (all use saturating/checked conversion)
</success_criteria>

<output>
After completion, create `.planning/phases/08-claude-code-adapter/08-01-SUMMARY.md`
</output>
